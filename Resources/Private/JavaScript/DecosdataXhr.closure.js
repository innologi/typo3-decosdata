(function(){function w(a,d,c,h,e,b){var g=true;if(h!==null){h+="-"+d;if(s[h]){console.info("[decosdata] data processing from cache");if(e!==null)g=e(s[h])===false;!g&&b!==null&&b(s[h]);return}}var f=new XMLHttpRequest;f.open(a,d,true);f.responseType="json";f.onload=function(){if(this.status!==200){console.error("[decosdata] "+this.status+": "+this.statusText);console.info(this)}if(this.response){var j=this.response;if(typeof j!=="object")j=JSON.parse(j);if(j.data){s[h]=j;if(e!==null)g=e(j)===false;
console.info("[decosdata] data processing success")}else{console.error("[decosdata] no valid xhr json response");console.info(j)}}else{console.error("[decosdata] no valid xhr json response");console.info(this)}};f.onerror=function(){console.error("[decosdata] failed to execute xhr");console.info(this)};f.ontimeout=function(){console.error("[decosdata] xhr timeout");console.info(this)};f.onloadend=function(){!g&&b!==null&&b(this)};f.send(c)}function x(a,d,c){var h="";switch(c){case "content":var e=
C(a);c=document.createElement("div");c.innerHTML=d.trim();d=c.getElementsByClassName("xhr-element");Array.from(d).forEach(function(b){e!==null&&D(++e,b);h+=b.outerHTML});t.set(a,e);break;default:d.forEach(function(b){var g=a.getElementsByClassName("content");Array.from(g).forEach(function(f){if(f.dataset.id&&b["content"+f.dataset.id])f.innerHTML=b["content"+f.dataset.id]});a.className="item item-"+b.id+" xhr-element";h+=a.outerHTML})}return h}function y(a){if(a===null)throw"no valid data container.";
a=a.querySelector(".xhr-element:last-child");return a===null?null:a.cloneNode(true)}function C(a){var d=null;if(t.has(a))d=t.get(a);else if((a=a.querySelector(".image-number"))&&a.dataset.number)d=parseInt(a.dataset.number,10);return d}function D(a,d){if((d=d.querySelector(".image-number"))&&d.dataset.number){d.dataset.number=a;d.innerHTML=a}}function E(){var a=this,d=false,c={},h=function(e,b){a.elementPositionReached(a.element)&&a.haltListener(e)&&b()};this.element=this.id=null;this.enable=function(e,
b,g){d&&this.disable();this.id=b;this.element=e;var f=true;e=function(){if(f){f=false;if(b.localeCompare(a.id)!==0)return a.haltListener(b);window.requestAnimationFrame(function(){h(b,g);f=true})}};window.addEventListener("scroll",e);window.addEventListener("resize",e);c[b]=e;d=true;h(b,g)};this.haltListener=function(e){if(c[e]){window.removeEventListener("scroll",c[e]);window.removeEventListener("resize",c[e]);delete c[e];return true}return false};this.disable=function(){for(var e in c)this.haltListener(e);
d=false};this.elementPositionReached=function(e){var b=document.compatMode!=="BackCompat"&&!/Edge/.test(navigator.userAgent)?document.documentElement:document.body;b=b.scrollTop+("innerHeight"in window?window.innerHeight:b.clientHeight);for(var g=0;e.offsetParent!==null;){g+=e.offsetTop;e=e.offsetParent}return b>=g}}function z(a){this.element=a;this.first=this.more=false;if(a.dataset.xhr){this.first=this.more=a.dataset.xhr;delete a.dataset.xhr}this.target=a.dataset.target?a.dataset.target:"section";
this.autoload=a.dataset.autoload?a.dataset.autoload.toLowerCase()==="true"||a.dataset.autoload==="1":false;var d=false,c=a;do c=c.parentNode;while(!(c===null||c.classList.contains(this.target)));if(c===null||!c.dataset.id)throw'xhr pager is not in anything designated "'+this.target+'"';this.id=(c.dataset.item?c.dataset.item+"_":"")+c.dataset.id;var h=c.querySelector(".xhr-container"),e=y(h);this.onReach=new E;this.disable=function(){d=false;a.className="xhr-paging";this.onReach.disable()};var b=this,
g=function(){if(d){d=false;console.info("[decosdata] paging fired");a.className="xhr-paging loader active";w("GET",b.more,null,null,function(f){if(b.autoload&&b.more.localeCompare(b.onReach.id)!==0){console.warn("[decosdata] out-of-sync xhr paging request");console.info({request:b.more});return false}h.innerHTML+=x(e,f.data,f.type);if(f.paging){b.autoload=true;b.enable(f.paging.more)}},null)}};this.enable=function(f){if(typeof f!=="string")this.disable();else{d=true;a.className="xhr-paging loader inactive";
this.more=f;this.autoload&&this.onReach.enable(a,f,g)}};c=a.querySelector(".more");if(!c){c=document.createElement("a");c.className="more";c.innerHTML="more";a.appendChild(c)}if(c.href)c.href="#";c.addEventListener("click",function(f){f.preventDefault();g()});this.enable(this.more)}function A(a){a=a.querySelectorAll(".tx-decosdata .xhr-paging");a.length>0&&Array.from(a).forEach(function(d){try{var c=new z(d);!d.dataset.xhr&&m[c.target][c.id]&&c.enable(m[c.target][c.id].first);m[c.target][c.id]=c}catch(h){console.warn("[decosdata] "+
h)}})}function F(a,d){if(a.length>0&&d.resultCount!==null){var c=parseInt(d.resultCount);Array.from(a).forEach(function(h){h.innerHTML=h.innerHTML.replace(h.dataset.count,c);h.dataset.count=c})}}function G(a,d,c){function h(){j=g.cloneNode(true);n=g.querySelectorAll(".pagebrowser .pagebrowser-navigation");o=g.querySelectorAll(".pagebrowser .resultcount");l=g.querySelector(".xhr-container");p=y(l)}function e(){if(n.length>0){Array.from(n).forEach(function(k){k.remove()});n=[]}}function b(){var k=i.searchBox.value.trim().length;
if(k===0||k>=c){i.searchBox.className="search-box full-width loader active";clearTimeout(u);u=setTimeout(i.submit,d)}}this.element=a;if(!a.dataset.xhr)throw"searchform is not xhr-enabled";this.action=a.dataset.xhr;delete a.dataset.xhr;a.elements["tx_decosdata[submit]"].className="search-submit invisible";this.searchBox=a.elements["tx_decosdata[search]"];this.resetSearchBoxCues=function(){this.searchBox.className="search-box full-width"};this.resetSearchBoxCues();if(!a.dataset.section)throw"no section set for search xhr";
var g=document.querySelector(".tx-decosdata .section-"+a.dataset.section);if(g===null)throw'search form could not find its designated "section"';this.xhrPager=m.section[a.dataset.section]?m.section[a.dataset.section]:null;var f=document.createElement("div");f.className="overlay loader active";var j=null,n=[],o=[],l=null,p=null;h();this.resetSection=function(){console.info("[decosdata] resetting section");g.parentNode.insertBefore(j,g);g.remove();g=j;A(g);this.xhrPager=m.section[a.dataset.section]?
m.section[a.dataset.section]:null;h()};var q=true,v="",u=null,i=this;this.submit=function(){if(!q){i.resetSearchBoxCues();return false}q=false;var k=i.searchBox.value.trim();if(k.localeCompare(v)===0){i.resetSearchBoxCues();q=true;return false}v=k;i.xhrPager&&i.xhrPager.disable();if(k.length===0){i.resetSection();i.resetSearchBoxCues();q=true;return false}l.parentNode.insertBefore(f,l);w("POST",i.action,new FormData(i.element),k,function(r){if(k.localeCompare(v)!==0){console.warn("[decosdata] out-of-sync xhr search request");
console.info({search:k});return false}e();l.innerHTML=x(p,r.data);if(r.paging){F(o,r.paging);if(r.paging.more){if(i.xhrPager===null){var B=document.createElement("div");l.parentNode.appendChild(B);i.xhrPager=new z(B);i.xhrPager.autoload=true;m.section[i.xhrPager.id]=i.xhrPager}i.xhrPager.enable(r.paging.more)}}},function(){f.remove();i.resetSearchBoxCues();q=true});return true};a.addEventListener("submit",function(k){k.preventDefault();clearTimeout(u);i.submit()||k.stopImmediatePropagation()});this.searchBox.addEventListener("input",
b)}if(window.XMLHttpRequest){var s=[];(function(a){a.forEach(function(d){d.hasOwnProperty("remove")||Object.defineProperty(d,"remove",{configurable:true,enumerable:true,writable:true,value:function(){this.parentNode!==null&&this.parentNode.removeChild(this)}})})})([Element.prototype,CharacterData.prototype,DocumentType.prototype]);if(!Array.from)Array.from=function(){var a=Object.prototype.toString,d=function(b){return typeof b==="function"||a.call(b)==="[object Function]"},c=function(b){b=Number(b);
if(isNaN(b))return 0;if(b===0||!isFinite(b))return b;return(b>0?1:-1)*Math.floor(Math.abs(b))},h=Math.pow(2,53)-1,e=function(b){b=c(b);return Math.min(Math.max(b,0),h)};return function(b){var g=this,f=Object(b);if(b==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var j=arguments.length>1?arguments[1]:void undefined,n;if(typeof j!=="undefined"){if(!d(j))throw new TypeError("Array.from: when provided, the second argument must be a function");if(arguments.length>
2)n=arguments[2]}var o=e(f.length);g=d(g)?Object(new g(o)):new Array(o);for(var l=0,p;l<o;){p=f[l];g[l]=j?typeof n==="undefined"?j(p,l):j.call(n,p,l):p;l+=1}g.length=o;return g}}();var t=new Map,m={section:{},content:{}};A(document);var H=null;try{if(document.forms.decosdatasearch)H=new G(document.forms.decosdatasearch,600,3)}catch(I){console.warn("[decosdata] "+I)}}else console.warn("[decosdata] no xhr support detected, cannot enable xhr features")})();